# Complete tmux configuration with LIGHT THEME
# Fixed status-style issue that was causing dark background

# `C-a' instead `C-b'
set-option -g prefix2 C-a
unbind-key C-b
bind-key C-a send-prefix

set-option -g visual-activity on
setw -g monitor-activity on
setw -g automatic-rename on
set -g base-index 1
set -g pane-base-index 1
# set -g terminal-overrides "*88col*:colors=88,*256col*:colors=256,xterm*:colors=256"
# set -g default-terminal "tmux-256color"
set -g terminal-overrides 'xterm*:smcup@:rmcup@'
setw -g history-limit 100000

# bind a reload key
bind R source-file ~/.tmux.conf \; display-message "Config reloaded.."

# if-shell 'test "$(uname -s)" = Darwin' 'set-option -g default-command "exec reattach-to-user-namespace -l $SHELL"'

# for vim
set -s escape-time 0

# VI key-binding
setw -g mode-keys vi
set-option -g status-keys vi
setw -g xterm-keys on
unbind %

bind | split-window -h
# bind h split-window -h
unbind '"'
bind - split-window -v
# bind v split-window -v

# hjkl pane traversal
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# VI-style copy/paste (http://jasonwryan.com/blog/2011/06/07/copy-and-paste-in-tmux/)
unbind [
bind Escape copy-mode
unbind p
bind p paste-buffer

set -g mouse on
# setw -g terminal-overrides 'xterm*:smcup@:rmcup@'
# bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
# bind -n WheelDownPane select-pane -t= \; send-keys -M

bind Enter copy-mode

# ==============================================================================
# DARK THEME (commented out - original configuration)
# ==============================================================================
# # Set left side status bar length and style
# set -g status-left-length 160
# set -g status-style "bg=black fg=black"
#
# # Display the session name
# set -g status-left "#[fg=white]Ξ\uebf6 [#S] #[black] #[default]"
#
# if-shell "uname | grep -q Darwin" {
#     set -ag status-left "#[fg=white,bg=default] \ue711 #(sw_vers -productVersion) #[default]"
#     set -ag status-left "#[fg=white,bg=default] \ueb2d #(test -f /usr/bin/pmset && pmset -g batt | tail -1 | awk '{print $3}' | tr -d ';') #[default]"
# }
#
# # Set right side status bar length and style
# set -g status-right-length 140
# set -g status-right-style default
#
# set -g status-right "#[fg=blue,bright,bg=default] \ueb01 #(env | grep SSH_CONNECTION && dig +short myip.opendns.com @resolver1.opendns.com || hostname) #[default]"
#
# # Display the date
# set -ag status-right "#[fg=white,bg=default] « %a %d#[default]"
#
# # Display the time
# set -ag status-right "#[fg=white,bright,bg=black] %l:%M %p #[default]"
#
# # set -ag status-right "#[fg=white,bright,bg=black] #(echo '#{pane_current_path}' | awk -F \$HOME '{print $2}')"
#
# # Display the hostname
# # set -ag status-right "« #[fg=red,bright,bg=default] #(env | grep GPG_TTY && echo "☁") #H #[default]"
#
# set -ag status-right "#[fg=white,bright,bg=black] #(python3 -c 'import psutil; avail = psutil.virtual_memory().available /1024.0 /1024.0; print(f\"\uefc5 {avail:.0f} MiB\")')"
#
# # Set the inactive window color and style
# set -g window-status-style fg=white,bg=black
# set -g window-status-format ' #I. » #W '
#
# set -g window-status-separator " » "
#
# # Set the active window color and style
# set -g window-status-current-style fg=black,bg=white
# set -g window-status-current-format ' #I* » #W '

# ==============================================================================
# LIGHT THEME (based on wush.json color scheme)
# ==============================================================================
# Colors from wush theme:
# - background: #f9f8f4 (warm light background)
# - text: #424242 (dark gray text)
# - text.muted: #616161 (muted gray)
# - accent: #005577 (blue accent)
# - element.active: #3581b8 (active blue)
# - status_bar.background: #f7f6ef (slightly darker than bg)

# CRITICAL FIX: Override status-style first to prevent green background override
set -g status-style "bg=colour255,fg=colour16"

# Set explicit light theme colors
set -g status-bg colour255
set -g status-fg colour16

# Left side status bar
set -g status-left-length 160
set -g status-left "#[fg=colour68,bg=colour255,bold]Ξ\uebf6 [#S] #[fg=colour16,bg=colour255] #[default]"

if-shell "uname | grep -q Darwin" {
    set -ag status-left "#[fg=colour16,bg=colour255] \ue711 #(sw_vers -productVersion) #[default]"
    set -ag status-left "#[fg=colour16,bg=colour255] \ueb2d #(test -f /usr/bin/pmset && pmset -g batt | tail -1 | awk '{print $3}' | tr -d ';') #[default]"
}

# Right side status bar
set -g status-right-length 140
set -g status-right "#[fg=colour68,bg=colour255] \ueb01 #(env | grep SSH_CONNECTION && dig +short myip.opendns.com @resolver1.opendns.com || hostname) #[default]"

# Display the date
set -ag status-right "#[fg=colour16,bg=colour255] « %a %d#[default]"

# Display the time
set -ag status-right "#[fg=colour16,bg=colour255,bold] %l:%M %p #[default]"

# Display memory usage
set -ag status-right "#[fg=colour16,bg=colour255,bold] #(python3 -c 'import psutil; avail = psutil.virtual_memory().available /1024.0 /1024.0; print(f\"\uefc5 {avail:.0f} MiB\")')"

# Window status - inactive windows
set -g window-status-style "fg=colour16,bg=colour255"
set -g window-status-format ' #I. » #W '

set -g window-status-separator " » "

# Window status - active window
set -g window-status-current-style "fg=colour255,bg=colour68,bold"
set -g window-status-current-format ' #I* » #W '

# Pane borders
set -g pane-border-style fg=colour16
set -g pane-active-border-style fg=colour68
